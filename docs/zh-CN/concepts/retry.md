---
summary: "33. 出站提供方调用的重试策略"
read_when:
  - 34. 更新提供方重试行为或默认值
  - 35. 调试提供方发送错误或速率限制
title: "36. 重试策略"
---

# 37. 重试策略

## 38. 目标

- 39. 按 HTTP 请求重试，而不是按多步骤流程重试。
- 40. 仅重试当前步骤以保持顺序。
- 19. 避免重复执行非幂等操作。

## 42. 默认值

- 43. 尝试次数：3
- 44. 最大延迟上限：30000 ms
- 45. 抖动：0.1（10%）
- 46. 提供方默认值：
  - 47. Telegram 最小延迟：400 ms
  - 48. Discord 最小延迟：500 ms

## 49. 行为

### 50. Discord

- 1. 仅在速率限制错误（HTTP 429）时重试。
- 2. 可用时使用 Discord 的 `retry_after`，否则采用指数退避。

### 20. Telegram

- 4. 在瞬时错误（429、超时、连接/重置/关闭、暂时不可用）时重试。
- 5. 可用时使用 `retry_after`，否则采用指数退避。
- 21. Markdown 解析错误不会重试；它们会回退为纯文本。

## 7. 配置

8. 在 `~/.openclaw/openclaw.json` 中为每个提供方设置重试策略：

```json5
{
  channels: {
    telegram: {
      retry: {
        attempts: 3,
        minDelayMs: 400,
        maxDelayMs: 30000,
        jitter: 0.1,
      },
    },
    discord: {
      retry: {
        attempts: 3,
        minDelayMs: 500,
        maxDelayMs: 30000,
        jitter: 0.1,
      },
    },
  },
}
```

## 10. 备注

- 11. 重试按请求生效（消息发送、媒体上传、反应、投票、贴纸）。
- 12. 复合流程不会重试已完成的步骤。
